import re
from RSA import gcd


def kasiski(chipher, n=3):
    """

    :param chipher: chiphertext
    :param n: min len of pattern > 3
    :return: list of periods without (1)
    """

    res = []
    for i in range(len(chipher)):
        #find all pos of substring
        positions = [i.start() for i in re.finditer(chipher[i: i + n], chipher)]
        #evaluate distance between mached substring
        l = [positions[i + 1] - positions[i] for i in range(len(positions) - 1)]
        #throw elems which less the estimated len of period
        l = list(filter(lambda x: x >= n, l)) #TODO: sum with next elem
        #TODO: try to retent not gcd but much counted elem
        #TODO: or try to delete elem which has no gcd
        if len(l) > 1:
            res.append(gcd(l))
    #filter empty and not possiple elems
    res = list(filter(lambda x: x >= n, res))

    res.sort()
    items = list(set(res))
    items.sort(key=lambda i: res.count(i))
    #list of pares elems and its count in res
    counts = [(i, res.count(i)) for i in items]
    #return [i[0] for i in counts if i[1] >= counts[-1][1]//2]
    return counts
text24 = '2603B3F8C1531F4D27DE165D654CA7BED40C4B1B749C4D1C3B5EF1E8D0001615709F1A193A08F5EED957161924C61C173E08A0EED95179260D910C5A7F2BA3F88C541D0C2D9B0C5D3E0BA3F9C151164F32870F5A3A08E6EB95153140258A1C463A15E6FD8447160C308C104A2A0FA3EEC1570A0C2F901A0E301EE6EB8F5A0744258C5F583A1EB5E38E5B534326DE0B463A4C83E488521E4D609D165E3709B4AA8C54104429901A027F0EB3FEC1541D0C29930F412D18A7E495151E452E910D472B15E6FD8447160C308C104A2A0FA3EEC1570A0C34961A0E3A1AA3E4C1581C5E25DE1C41321CAAE38254074924DE0B593A00B0EFCC471C582F8C5F62301EA3E49B15207674CC5F413141AAE38F50535825921A5E2D05A8FE8447534F298E174B2D4CABEB825D1A4225D075241905B0EFC14216492B8D5F4C3A0AA9F88415074425DE105B2B0EB4EF805E534326DE084F2D40E6E38F15244D328D1E59734C96E58D541D48678D5F6D361CAEEF93153159329B1E5B7F1EA3FC84541F4924DE165A2C4CA7E9895C165A25931A402B1FE6E38F15115E259F1447310BE6CF8F5C144121DE0B417F0DB5FE8E5B1A5F289B1B0E191EA3E4825D534D2E9A5F6C2D05B2E3925D535C258C0C413102A3E6CF15274425DE3D5C3618AFF98915065F259A5F5A3709E6DA8E59165F67DE16403903B4E780411A432EDE1E403B4CB2EF825D1D45318B1A5D734CA7E48515074425DE3A40360BABEBC1561F432E9B5F5D3A02B2AA955A5358289B120E3602E6CB9452065F34DE4E176C55EAAA965D1A4F28DE185C3A0DB2E698151A42238C1A4F2C09A2AA955D164532DE575E2D09B0E38E40004039DE094B2D15E6E688581A58259A560E2C19A5E98446000C29905F4A3A0FB4F391411A4227DE3A40360BABEBC158165F339F184B2C42CC80B55D160C2291124C3A4CB1EB92151242609B134B3C18B4E58C5010442190164D3E00E6EE84431A4F25DE0846301FA3AA87401D4F349710407F1BA7F9C1411C0C24970C4D301AA3F8C1461C4125DE10487F18AEEFC15112452C875F5D3A18B2E38F52000C2F985F5A3709E6CF8F5C144121DE124F3C04AFE4844653432EDE0B463A4CB0EB935C1C5933DE384B2D01A7E4C1581A40298A1E5C264CA8EF95421C5E2B8D510E1618B5AA915C1C42259B0D47310BE6EE84461A4B2EDE084F2C4CA2EF97501F43309B1B0E3D15E6CB8D541D0C148B0D47310BE6A2965C0744609F110E3601B6E59341124234DE1C413118B4E3834007452F905F482D03ABAAA65A01482F905F793A00A5E28C541D05609F114A7F18AEEFC158124F2897114B7F1BA7F9C1501D4B29901A4B2D09A2AA834C5364218C10423B4CE1CE8E56540C0B9B1A407F03A0AA955D160C028C165A361FAEAAB55411592C9F0B47310BE6C780561B452E9B5F6D3001B6EB8F4C5D0C059F1C467F01A7E9895C1D4960891E5D7F0DA4E59441531B60981A4B2B4CEEB8CF04534169DE17473804E6EB8F51535B299A1A027F5EE6EC8450070C68CE51186E4CABA3C151164930DE1E403B4CB1EF88521B4924DE1E4C3019B2AA801507432ED075241E18E6E39546535C259F14027F2B85ACA266535B218D5F5C3A0DA2E38F52534D308E0D412705ABEB95501F5560CA4F1E6F4CABEF9246124B258D5F5E3A1EE6EE804C5D0C018D5F4F7F04A3EE8650534D279F16402C18E6EF8F501E55609F0B5A3E0FADAA8C5A0058609C10433D09B5AA96500149609A165D2F09B4F9845153582FDE16402C18A7E68D5407452F900C0E3E18E6CB8546074323955F4F3108E6DD804316422491110E770EA9FE89151F4D349B0D0E2C19B6FA8D541D58259A5F4C264CAFE4924112402C9F0B473002B5AA8041537F349F1143301EA3AA805B170C059F0C5A3C03B2EFC815124224DE384F2604B3F892415D264AB20A482B1BA7EC87505341258D0C4F3809B5AA96500149608A174B7F0AAFF8924153582FDE1D4B7F1EA3EB85151A42608F0A4F3118AFFE981B5378289B5F693A1EABEB8F151D4D36875F463E08E6E794561B0C349718462B09B4AA91471C4F259A0A5C3A1FEAAA805B170C34961A0E3C0DB6FE9447160C2F985F4D3008A3AA835A1C4733DE084F2C4CA8EF84511648609C1A48301EA3AA955D1655609D105B3308E6E88415115E2F951A40714C91E2845B5F0C29905F683A0EB4FF80470A0C71C74B1C734CB2E28415344932931E407F02A7FC98151A42348C104A2A0FA3EEC1411B496098105B2D41B4E5955A010C05901649320DE6EC8E47534F2F93125B3105A5EB955C1C4233DE08472B04E6E39546536D34921E402B05A5AAB4181143218A0C027F18AEE39215075E219819473C4CA4EF82541E49608B115C3A0DA2EB8359160C26910D0E3E4CB6EF935C1C486091190E2B09A8AA8C5A1D58288D510E1D1EAFFE805C1D0C308C104A2A0FA3EEC1581C482998164B3B4CA4E58C57165F6CDE1D5B2B4CAFFEC142125F608A174B7F1FB3E98250005F6091190E2B04A3AAB46653622188060E3D03ABE884150744218A5F593E1FE6FE895053412197110E2C03B3F88250534326DE0D4B3E08AFE486151E49338D1E493A1FE6EC935A1E0C3496165D7F1AA3F8925C1C426091190E1A02AFED8C54534A2F8C5F5A3709E6F88446070C2F985F5A3709E6FD80475D0C0D9B0C5D3E0BA3F9C142165E25DE0C4B3118E6FE8E15124224DE195C304CA7E9935A005F608A174B7F2DB2E6805B074523DE1D577F09A8E988451B49329B1B0E2B09AAEF91471A42349B0D0E3305A8E1921B792614961A0E1303B4EF8F4F5341258D0C4F3809B5AA96500149609D104A3A02A7E784515378359011577F0DB2AAA35916582396134B264C96EB935E5D0C14961A577F1BA3F884151C422C875F5D3A02B2AA885B535D359F115A3618BFAA87471C416093164A725DFFBED31B5378289B5F7A2A02A8F3C15B165837910D452C4CB1EF93505359339B1B0E3903B4AA895C14446D921A583A00E6E78446004D279B0C0E3D09B2FD84501D0C079B0D433E02E6C288521B0C039112433E02A2AA805B170C26971A423B4CA5E58C581242249B0D5D714C91E3955D5358289B5F463A00B6AA8E53536B258C124F314CA9FA844712582F8C5F4B2D1EA9F892195358289B5F4D2D15B6FE805B1240398D0B5D7F05A8AA955D160C149B0C5A3A1EBFAAC95B1241259A5F4F3918A3F8C167124030965F7A3A1FB2EF93195345348D5F463A0DA2A3C1421C5E2B9B1B0E3019B2AA955D160C2C9118473C0DAAAA92410159238A0A5C3A4CA9ECC1411B4960931E4D3705A8EFC151165F30970B4B7F02A9FEC15E1D43379711497F05B2F9C1451B5533971C4F334CA0E593585D0C14961A577F08A3FC88461648609F0A5A3001A7FE88565341219D17473109B4F3C1411C0C289B135E7F1BAFFE89151749238C065E2B05A9E4CD150444299D170E3C19AAE7885B1258259A5F47314C85E58D5A005F358D530E2B04A3AA965A014024D90C0E3905B4F99515035E2F990D4F3201A7E88D5053482999165A3E00E6EF8D501058329111473C4CA5E58C450658258C510E0B04AFF9C142125F609A1A5D360BA8EF8515124224DE1D5B3600B2AA834C53782F9312577F2AAAE59650015F609F114A7F04AFF9C141164D2DDE1E5A7F18AEEFC1651C5F34DE30483905A5EFC167165F259F0D4D374C95FE80411A432EDE1E5A7F28A9E68D5C000C08971342714C92E284151545328D0B0E280DB5AA85501F45369B0D4B3B4CB2E5C1771F49349D17423A15E6DA8047180C29905F6A3A0FA3E78350010C71C74B1D7F0DA8EEC1561C412D970C5D3603A8EF8515074425DE19413300A9FD885B140C069B1D5C2A0DB4F3CF153642289F114D3A01A3E49546535B258C1A0E3B09B0EF8D5A034924DE19412D4CB2E284153E4D32955F1C7F2FA9E68E46005933D25F5A3709E6EC884700586091190E2804AFE98915044D33DE08412D07AFE48615125860BC134B2B0FAEE6844C537C218C140E3002E6FE895053412F8C1147310BE6E587153701249F060E3602E6C0945B160260B813412809B4F9C1411B492EDE0F5C3008B3E9845153432E9B5F6D3000A9F99240000C21DE12413118AEAA875A010C34961A0E2D09B5FEC15A150C34961A0E280DB4A6C15812472990180E3E4CB2E595541F0C2F985F5A3A02E6FD88411B0C21905F4B3309B0EF8F411B0C309F0D5A720EB3E38D415D0C14961A0E320DA5E2885B165F60891A5C3A4CA9FA84471258259A5F433E05A8E69815115560A90D4B311FE6E38F15120C339B1C5A3603A8AA8F541E4924DE0B463A4C88EF9658124232875F4F3918A3F8C15C075F60961A4F3B4C8BEB99153D4937931E407166CCC88D50074F28921A57781FE6FD8E47180C379F0C0E3A1FB5EF8F411A4D2CDE0B417F08A3EC845407452E995F5A3709E6DFCC571C4D348D5F47314CB2E28415314D348A134B7F03A0AA955D160C018A134F3118AFE9CD15124224DE0B417F18AEEFC177014534970C467F02A7FC8059535A299D0B412D05A3F9C15C1D0C34961A0E1D0DB2FE8D50534326DE3C4F2F09E6C78041125C21905F4F3108E6FE8950536E218A0B423A4CA9ECC17B1C5E34965F6D3E1CA3A4C17C1D0C71C74B1F734C93E69547120C25861A5C2B09A2AA80150343379B0D482A00E6EF8753164F34DE10407F18AEEFC17B1C5E34965F6F391EAFE9805B5348258D1A5C2B4CA5EB8C45124527905F4F380DAFE49241536B258C124F314CA0E59356165F608B114A3A1EE6CD845B165E21925F6B2D1BAFE4C1671C412D9B13007F2BA3E48447124060AD165C7F2FAAEB9451160C018B1C463602AAEF825E535B32910B4B7F18AEEB95150449329B5F472B4CA8E59515154332DE2A422B1EA7A6C11721432D931A427F1BA9FF8D51534421881A0E3C09B4FE805C1D4039DE18412B4CB2E2935A064B28DE0B417F2FA7E3935A510260A917473309E6E48E41534F289F11493602A1AA955D160C25881A402B1FEAAAC3601F58329F5D0E3B09A5F89845075F60981A4F2B19B4EF8515035E2F9316403A02B2E698151A42608A174B7F1FB2E5934C534326DE305E3A1EA7FE885A1D0C13BF336F1240E6C6804609402FDE3E42320DB5F3C6465348218C1640384CABE392461A432EDE1E4D2D03B5F9C1411B4960B2164C260DA8AAA5500049328A5F4C3A04AFE4851516422593060E3305A8EF92151A4260CF461A6D42E6DA935C1C5E608A100E2B04A3AAAF5A014121901B577F00A7E4855C1D4B33DE10407F28EBCE804C53452EDE355B3109E6BBD8014700608A174B7F2DAAE68850000C2B901A597F18AEEFC1591C4F218A1641311FE6E5871512402CDE1D5B2B4CB2FD8E151C4A60B91A5C320DA8F3C646534A29980B577209AFED8941537B258D0B4B2D02EBEC935A1D58609A1658361FAFE58F465D'
text4 = 'СЪСШ ЩГЖИСЮБЩЫРО ФЧ РЛЫОУУПЦЛЫ ЦЙУБЭЫФСЮДЯ ЛКЧААЮЦЩДХИЯ Б ХЙЕУЖ ШЩ ЧЙХК ЯПУЩА УОРЧЙ ЧЬЩ ЬЙЬЩУЙЙЧ Е ПЛЖЮС ЧАХОИ ЩЦ ЛЩДФСНБЮСЛ Щ ЙККЦЖЦЛЩ ЭЙСНШТ ЩЧЫОВХЮДИ ЗЗН ЛЪЯД ЛЕЖОН ЕЮЧЪЛМСРТЖЦЬВЖ ЛГСЗЙЬЧШ НФЧЗ ЧЮАЮЕ ЛЖЙКУАХЙНАИЕЬВ ЙЦЛ ККФЩУЮИЙЧ З ЬЦСЙВГЫХ СОЗЖЪНШШО ЛЪЯД ЦСЗНКЕШЛГЫХ ЦЩЗШО ЦСПЛЛТП С ЧАХЙВЩ ЮЙЦСЗХФС КЗСАХЦЩ СЙФФЗШО ЛЪЯД РЛЬНГЫХЪЖ ДПХЛЕЗ НФЧГХЛ ШЙ ШУЩ ЮОЕЛХЧУЛУ ЩКЯЙЛЩНКЫЭА ЕЧРЮЗЫГЧЖФЖ ЩЦ ЧРШЙЛЩМ ДЛВОЖЫРО КЙЯЛЫОЖЧЖФПШЙЪНХ ХЙЕЩЖ СЪСШ СЬЛРНГ ШПРТЗПЗН ЧЕЧУЦЖЪЕЩУС РЫСОНШЙ ЩЩТЖЛТЕЗ СЪСПХЛ СПРЬЛЕСЧШЙЪНХЩ ЪЙУЖЫЬЛ ЯЧВАЕЧИ ЩРЩТ ОЕФЖЫХЪЖ ДХЩЩЩХОВХЮДФ ЩРЩТ Щ ЗМУВ ЫЩГЕПЫЛЖПЯЛЩ Е ШУБЭЫЛЯЖ ЛЩДФСНБЮСЖ ШПБВЩ КЛЩА УОРЧЙ С ЛЪЯД Р ЮЯЙЭЩИЙЯЩ ЭЧНЛЯДФ ДЙРЧБЩЫРО ЫФЖ НЖЫФМ ЕРУЛКФТЕЗ У ЬЩУ ЧНШЙЪЖЧКИ ЧЩЫЙЕЧЗАФДЭСФ ЮЙНЭЩСЦТА З СЪСШ РГФПЛТ З ЙЪЬЛЕО ЛР ИОСЩХ АФЧЭЧ ЩЮЯОЧАИОЬШЙО ЦСЙМУБУХЬЛЖ ЪЩНЖЩСБЮСФ НЗНГЯХСЮАКУЛА ЬЙЧБМС Л ГЖФФШПШУБЕФФШЮЧФ ЛЪЬЮАЮСФ НИИ ДЛЯЧЫЛ ЙЩЪБЮСОЛЕЙЬШЙТ СЩЬЦЛ НЖЫФМ Е НФЧКУЩЕ КЙЧК ЮОЩФЦЧЧЩУЧ УБЬЦЩЛЪЩГЖЗО ЛЪЯ ЫГЯ ЭЙЕ ЧЙФПЯЙ ШУЩ ОЫЛР АЪВЛЕСЖР ЪЬЧАХ ЧААКШФЦЖЦГ НЖЫЖЕ ЕЧОЕЙПЬЛКЫП ЩЮЫФСЖЪЬЛТ С РЛЫОУУПЫФТГЦЩМ ЫОЖЧЖФПШЙЪНЩ УЦЩЪЙЧАСПРЛА ХСЦЛЕ ЛЛНЙЛ ЗЛЯХ ЛЪЯ ЦФЩЬКФУЮЧ ЕБЭ ЦФЩЬКФУЮЧ ЯШЙМЩЛЪЩГЖЗО СЩЬЦЛ ЯЙЫЩСАЗ ЩШЗ ЧНСППГЫХ УГЯ ЮОЛЖЪОСШЙ ХЬЛРЧЩФЯЙОЩЖ ЦФДУЧНСД ЦГ ЗЮОЫШЩЗ РРЙПФДХЕ ЛЪЯ ЧЧШЙМЩ ЧЗШГ ЕЙНФТЗ'
text6 = 'UTPDHUG NYH USVKCG МУСЕ FXL KQIB. WX RKU GI TZN, RLS BHZLXMSNP KDKS; СЕВ Ш HKEWIBA, YYM SRB PER SBS, JV UPL О UVADGR HRRWXF. JV ZTVOOV УН ZCQU У UKWGEB, PL UQFB Р FOUKCG, TBF RQ VHCF R KPG, 0U КЕТ ZCQU MAW QKKW ZGSY, ЕР PGM QKETK UQEB DER EZRN, MCYE, MG UCTESVA, WP КЕТ ZCQU MAW KOIJS, LCOV NTHDNV JPNUJVB Ш GGV RWX ONKCGTHKFL XG VKD, ZJM VG CCI MVGD JPNUJ, RLS EWVKJT ASGUCS MVGD; DDK VG NYH PWUV CCHIIY RD DBQN RWTH PFRWBBI VTTK VCGNTGSF FL IAWU XJDUS, HFP VHSF, RR LAWEY QDFS RVMEES FZB СНН JRTT MVGZP UBZN FD ATIIYRTK WP КЕТ HIVJCI; TBF BLDPWPX RWTH ULAW TG VYCHX KQLJS US DCGCW OPPUPR, VG KFDNUJK GI JIKKC PL KGCJ lAOV KFTR GJFSAW KTZLZES WG RWXWT VWTL WP XPXGG, CJ EPOS VYC BTZCUW XG ZGJQ PMHTRAIBJG WMGEG. JZQ DPB JVYGM ZCLEWXR:CEB lAOV NYH JIKKC TGCWXE UHE JZK. WX VCULD YTTKETK WPKCGVCWIQT PWVY QEBFKKQ, QNH NZTTWIREL IAS VERPE ODJRXGSPTC EKWPTGEES, GMCG TTVVPLTEEJ; YCW WV NYH TZYRWH LOKU MU AWO, KEPM VG BLTP VQN RD DSGG AWKWUKKPL KGCJ, XY GPP KPG ONZTT ICUJCHLSE KET DBQHJTWUG. DYN MVCK ZT MEWCW HTWE ED JL, GPU YAE CH LQ! PGR UE, YH MWPP RXE CDJCGOSE, XMS UZGJQJL, SXVPN HBG!'
res = kasiski(text6, 3)
#res = list(set(res))
#res.sort()
print (res)
